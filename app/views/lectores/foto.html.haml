#webcam
%script{type: 'text/javascript' }
  :plain
    function onload_complete(msg) {
      // fetch the CSRF meta tag data
      var csrf_param = $('meta[name=csrf-param]').attr('content');
      var csrf_token = $('meta[name=csrf-token]').attr('content');

      // reset the api URL appending the auth token parameter
      webcam.set_api_url('#{upload_lector_path(@lector)}' + '?' + csrf_param + "=" + encodeURI(encodeURI(csrf_token)));
    }

    function upload_complete(msg) {
      if (msg == 'ok') {
        //$('#new_photo').show();
        //$('#photo_description').focus();
      } else {
        alert('An error occured');
        webcam.reset();
      }
    }

    webcam.set_swf_url('/webcam.swf');
    webcam.set_api_url('#{upload_lector_path(@lector)}');
    webcam.set_quality(90);
    webcam.set_shutter_sound(true, '/shutter.mp3');
    webcam.set_hook('onLoad', 'onload_complete');
    webcam.set_hook('onComplete', 'upload_complete');
    $('#webcam').html(webcam.get_html(320, 240));

%input{type: 'button',  value:'Take picture', onclick:'webcam.snap();'}
%input{type: 'button',  value:'Configure', onclick:'webcam.configure();'}
